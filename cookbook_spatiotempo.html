

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cookbook - Spatio-Temporal datasets &mdash; NeuroHDF v0.1 documentation</title>
    <link rel="stylesheet" href="_static/navy.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="NeuroHDF v0.1 documentation" href="index.html" />
    <link rel="next" title="Cookbook - Generic datasets" href="cookbook_generic.html" />
    <link rel="prev" title="The Region" href="region.html" />
 
<script type="text/javascript">


  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17713054-4']);
  _gaq.push(['_trackPageview']);

  (function() {
   var ga = document.createElement('script');
   ga.src = ('https:' == document.location.protocol ?
             'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
   ga.setAttribute('async', 'true');
   document.documentElement.firstChild.appendChild(ga);
 })();

</script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cookbook_generic.html" title="Cookbook - Generic datasets"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="region.html" title="The Region"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">NeuroHDF v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Cookbook - Spatio-Temporal datasets</a><ul>
<li><a class="reference internal" href="#regular-datasets">Regular datasets</a><ul>
<li><a class="reference internal" href="#n-dimensional-contiguous-homogeneous-dataset">N-dimensional contiguous, homogeneous dataset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#irregular-datasets">Irregular datasets</a><ul>
<li><a class="reference internal" href="#d-skeletons-microcircuitry">3D skeletons / microcircuitry</a></li>
<li><a class="reference internal" href="#set-of-3d-triangular-surfaces">Set of 3D triangular surfaces</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="region.html"
                        title="previous chapter">The Region</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cookbook_generic.html"
                        title="next chapter">Cookbook - Generic datasets</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="cookbook-spatio-temporal-datasets">
<span id="spatiotempo"></span><h1>Cookbook - Spatio-Temporal datasets<a class="headerlink" href="#cookbook-spatio-temporal-datasets" title="Permalink to this headline">¶</a></h1>
<p>This page introduces NeuroHDF convention for the hierarchical layout of spatio-temporal datasets (datasets
with underlying geometry) that can be an element of a <em>Region</em>. A description of the usage of HDF5 Groups
and Dataset nodes is given.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For metadata attributes, 0-indexed is the convention (Python convention).
Matlab uses 1-indexed convention, so the indices need to be incremented by one in Matlab.</p>
</div>
<div class="section" id="regular-datasets">
<h2>Regular datasets<a class="headerlink" href="#regular-datasets" title="Permalink to this headline">¶</a></h2>
<div class="section" id="n-dimensional-contiguous-homogeneous-dataset">
<h3>N-dimensional contiguous, homogeneous dataset<a class="headerlink" href="#n-dimensional-contiguous-homogeneous-dataset" title="Permalink to this headline">¶</a></h3>
<p>A data block with at least one spatial dimension. It may have temporal dimensions. There are usually
additional dimensions (trials, channels, subjects etc.). All information about the axes are stored in
the JSON header.</p>
<p>Examples:</p>
<ul class="simple">
<li>Microscopy where measurement sensors are on a regular grid</li>
<li>2D pixel-based slices</li>
</ul>
<p>The affine represents the transformation from voxel space to the <em>Region</em> space.
If 3 spatial axes exist, it has shape (4,4) for translations, rotations, zooms, shears.
for 2 spatial axes, it would be shape (3,3). The zooms define the spatial resolution.
Individual components <a class="reference external" href="https://github.com/matthew-brett/transforms3d/blob/master/transforms3d/affines.py">can be extracted</a>.</p>
<p>The <em>axes_semantics</em> refers to the output of the affine transformation. The spatial axes (kind: spatial)
should be aligned with the corresponding spatial axes of the <em>Region</em>. They should be be ordered, i.e.
the first spatial axes of the <em>Region</em> corresponds to the axis with index 1 in our case.</p>
<p>Open Questions:</p>
<ul class="simple">
<li>When rotation occurs in the affine transformation, the semantics of pre/post transformation could be changed.
Otherwise, with only scaling and translation, they are expected to stay invariant</li>
</ul>
<p>NeuroHDF node:</p>
<div class="highlight-python"><pre>Group["Regular data block"]

    Dataset["data"] -&gt; nd array
    .attrs["affine"] -&gt; 2d array, shape (4,4) for 3 spatial axes
    .attrs["axes_semantics"] = {
        0 : {"name" : "t",
             "unit" : {"name": "millisecond", "OBO" : "UO:0000028"},
             "sampling frequency" : 256,
             "kind" : "temporal" },
        1 : {"name" : "x",
             "unit" : {"name": "meter", "OBO" : "UO:0000008"},
             "kind" : "spatial" },
        2 : {"name" : "y",
             "unit" : {"name": "meter", "OBO" : "UO:0000008"},
             "kind" : "spatial" },
        3 : {"name" : "z",
             "unit" : {"name": "meter", "OBO" : "UO:0000008"},
             "kind" : "spatial" },
        4 : {"name" : "r",
             "desc" : "Red channel measurement"},
        5 : {"name" : "g" },
        6 : {"name" : "b" },
        7 : {"name" : "trial" }
    }</pre>
</div>
</div>
</div>
<div class="section" id="irregular-datasets">
<h2>Irregular datasets<a class="headerlink" href="#irregular-datasets" title="Permalink to this headline">¶</a></h2>
<div class="section" id="d-skeletons-microcircuitry">
<h3>3D skeletons / microcircuitry<a class="headerlink" href="#d-skeletons-microcircuitry" title="Permalink to this headline">¶</a></h3>
<p>Irregular spatial data, namely N vertices with spatial location, but no temporal data.
Properties such as label data exists on the vertices and connectivity.
We stack multiple skeletons (tree topologies) with N vertices with spatial location and M connections.</p>
<p>Examples:</p>
<ul class="simple">
<li>Cellular morphologies (skeletonized)</li>
<li>Skeletonized reconstructions from electron microscopy, e.g. with <a class="reference external" href="https://github.com/acardona/CATMAID">CATMAID</a></li>
</ul>
<p>Open Questions:</p>
<ul class="simple">
<li>Is the <em>spatial location</em> unit&#8217;s defined after application of the affine transformation?
Or are the axes semantics in this case refering to the array axes?</li>
</ul>
<p>NeuroHDF node:</p>
<div class="highlight-python"><pre>Group["3D Skeletons"]

    Group["vertices"]
        Dataset["data"] : array, shape (N,3) with spatial location
        .attrs["affine"] : 2d array, shape (4,4)
        .attrs["axes_semantics"] = {
            0 : {"name":"entities"},
            1 : {"name":"spatial location",
                 "column": {
                    0 : { "name" : "x", "unit" : {"name": "meter", "OBO" : "UO:0000008"} },
                    1 : { "name" : "y", "unit" : {"name": "meter", "OBO" : "UO:0000008"} },
                    2 : { "name" : "z", "unit" : {"name": "meter", "OBO" : "UO:0000008"} },
                 } } }

        Group["properties"]
            Dataset["type"] array, shape (N,1)
            .attrs["semantics"] = {
                1 : {"name" : "skeleton node"},
                2 : {"name" : "connector  node"}
            }

        Group["connectivity"]
            Dataset["data"] array, shape (M,2)
            -&gt; stores the connectivity between vertices in 0-indexed (global topology) array
            .attrs["semantics"] = {
                0 : {"name":"entities"},
                1 : {"name":"connections",
                     "column" : {
                        0 : {"name" : "from"},
                        1 : {"name" : "to"},
                     },
                     "directed" : False
                    }
            }
            Group["properties"]
                Dataset["type"] array, shape (M,1)
                .attrs["semantics"] = {
                    1 : {"name" : "axonal arbor"},
                    2 : {"name" : "dendritic arbor"},
                    3 : {"name" : "cell body"},
                    4 : {"name" : "spine"},
                    5 : {"name" : "presynaptic to"},
                    6 : {"name" : "postsynaptic to"},
                }
                Dataset["id"] array, shape (M,1)</pre>
</div>
<p>Example code to create the dataset node:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="n">myfile</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s">&#39;ff.h5&#39;</span><span class="p">)</span>

<span class="n">dset</span> <span class="o">=</span> <span class="n">myfile</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&quot;3D Skeletons&quot;</span><span class="p">)</span>
<span class="n">vert</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&quot;vertices&quot;</span><span class="p">)</span>

<span class="n">vert</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">)))</span>

<span class="n">vert</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&quot;properties&quot;</span><span class="p">)</span>
<span class="n">vert</span><span class="p">[</span><span class="s">&quot;properties&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;labels&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,(</span><span class="mi">10</span><span class="p">,)))</span>
<span class="n">vert</span><span class="p">[</span><span class="s">&quot;properties&quot;</span><span class="p">][</span><span class="s">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&quot;semantics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
    <span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;axonal arbor&quot;</span><span class="p">},</span>
    <span class="mi">2</span> <span class="p">:</span> <span class="p">{</span><span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;dendritic arbor&quot;</span><span class="p">},</span>
    <span class="mi">3</span> <span class="p">:</span> <span class="p">{</span><span class="s">&quot;name&quot;</span> <span class="p">:</span> <span class="s">&quot;cell body&quot;</span><span class="p">}</span> <span class="p">})</span>

<span class="n">vert</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&quot;grouping&quot;</span><span class="p">)</span>
<span class="n">vert</span><span class="p">[</span><span class="s">&quot;grouping&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;index&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">300</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">]]))</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">vert</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s">&quot;connectivity&quot;</span><span class="p">)</span>
<span class="n">con</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>

<span class="n">myfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="set-of-3d-triangular-surfaces">
<h3>Set of 3D triangular surfaces<a class="headerlink" href="#set-of-3d-triangular-surfaces" title="Permalink to this headline">¶</a></h3>
<p>NeuroHDF node:</p>
<div class="highlight-python"><pre>Group["3D Surfaces"]

    Group["vertices"]
        Dataset["data"] : array, shape (N,3) with spatial location
        .attrs["affine"] : 2d array, shape (4,4)
        .attrs["axes_semantics"] = {
            0 : {"name":"entities"},
            1 : {"name":"spatial location",
                 "column": {
                    0 : { "name" : "x", "unit" : {"name": "meter", "OBO" : "UO:0000008"} },
                    1 : { "name" : "y", "unit" : {"name": "meter", "OBO" : "UO:0000008"} },
                    2 : { "name" : "z", "unit" : {"name": "meter", "OBO" : "UO:0000008"} },
                 } } }

        Group["properties"]
            Dataset["type"] : array, shape (N,1)
            .attrs["semantics"] = {
                1 : {"name" : "axonal arbor"},
                2 : {"name" : "dendritic arbor"},
                3 : {"name" : "cell body"}
            }
            Dataset["id"] : array, shape (N,1)

        Group["connectivity"]
            Dataset["data"] : array, shape (M,3)
            -&gt; global topology of triangular faces. find local topology by subtracting min()
            .attrs["semantics"] = {
                0 : {"name": "entities" },
                1 : {"name": "triangular faces", "directed" : False }
            }
            Group["properties"]
                Dataset["type"] : array, shape (M,1)
                Dataset["id"] : array, shape (M,1)</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="cookbook_generic.html" title="Cookbook - Generic datasets"
             >next</a> |</li>
        <li class="right" >
          <a href="region.html" title="The Region"
             >previous</a> |</li>
        <li><a href="index.html">NeuroHDF v0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, NeuroHDF Developers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>